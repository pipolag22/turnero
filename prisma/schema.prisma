// ---------- GENERATOR ----------
generator client {
  provider = "prisma-client-js"
}

// ---------- DATASOURCE ----------
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ---------- ENUMS (roles del sistema) ----------
enum Role {
  ADMIN
  BOX_AGENT
  PSYCHO_AGENT
  CASHIER_AGENT
}

// ---------- MODELOS auxiliares ----------
model User {
  id           String   @id @default(cuid())
  email        String   @unique
  name         String
  role         Role
  office       String?
  boxNumber    Int?
  passwordHash String
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@index([role])
  @@index([boxNumber])
}

model AuditLog {
  id        String   @id @default(cuid())
  action    String
  ticketId  String?
  userId    String?
  meta      Json?
  createdAt DateTime @default(now())
}

// ---------- ENUMS del turnero (únicos y finales) ----------
enum TicketStatus {
  EN_COLA
  EN_ATENCION
  DERIVADO
  FINALIZADO
  CANCELADO
}

enum TicketStage {
  RECEPCION
  BOX
  PSICO
  FINAL
  CAJERO
}

// ---------- MODELO Ticket (ÚNICO) ----------
model Ticket {
  id              String       @id @default(uuid())

  // Campos usados por el front nuevo
  nombre          String?
  status          TicketStatus @default(EN_COLA)
  stage           TicketStage  @default(RECEPCION)
  date            DateTime

  // (opcionales por si los usás)
  assignedBox     Int?
  assignedUserId  String?
  calledAt        DateTime?

  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt

  @@index([date])
  @@index([date, stage, status, createdAt])
}
model SystemStatus {
  id              String   @id @default("singleton")
  alertaEnabled   Boolean  @default(false)
  alertaText      String   @default("")
  teoricoStatus   String   @default("INACTIVO") // "ACTIVO" o "INACTIVO"
  // CAMBIO: Nuevas opciones para el estado del práctico
  practicoStatus  String   @default("INACTIVO") // "INACTIVO", "CIRCUITO_AUTOS", "CIRCUITO_MOTOS", "SUSPENDIDO_LLUVIA"
  updatedAt       DateTime @updatedAt
}